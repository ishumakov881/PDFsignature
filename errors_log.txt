# Лог ошибок PDF Signature App

## Общие рекомендации
- Всегда проверять наличие разрешений перед работой с файловой системой
- Использовать try-catch при работе с PDF файлами
- Валидировать входные данные перед сохранением в базу
- Проверять размер PDF файла перед загрузкой
- Использовать корутины для асинхронных операций
- Определять все маршруты навигации в Screen.kt
- Использовать типизированные аргументы в навигации
- При импорте файла всегда копировать его в локальное хранилище
- Хранить в базе относительные пути к файлам

## Зависимости
### Koin
- Используется версия 4.1.0-Beta5
- Добавлены модули:
  - koin-core: базовый модуль DI
  - koin-android: поддержка Android
  - koin-compose: интеграция с Jetpack Compose
  - koin-compose-navigation: навигация в Compose
- Важно: при обновлении версии Koin проверять совместимость с Compose

## Ошибки и решения 

### Проблема с путями файлов
- Что сломалось: Неправильное сохранение путей к файлам в базе данных, использование абсолютных путей
- Как починил: 
  1. Добавил конвертацию между абсолютными и относительными путями
  2. Изменил логику сохранения файлов в постоянное хранилище
  3. Обновил методы для работы с путями в PdfRepositoryImpl
- В каком файле была ошибка: 
  - PdfRepositoryImpl.kt
  - DocumentListViewModel.kt
- Советы:
  1. Всегда используйте относительные пути при сохранении в базу данных
  2. Храните файлы в постоянном хранилище приложения (filesDir)
  3. Конвертируйте пути при чтении/записи в базу данных

### Проблема с навигацией
- Что сломалось: Маршруты для просмотра и редактирования документов не были определены в навигационном графе
- Как починил:
  1. Добавил новые объекты DocumentViewer и DocumentEditor в Screen.kt
  2. Определил типизированные аргументы для маршрутов
  3. Обновил NavHost в MainActivity.kt
  4. Исправил навигацию в DocumentListScreen.kt
- В каких файлах была ошибка:
  - Screen.kt
  - MainActivity.kt
  - DocumentListScreen.kt
- Советы:
  1. Всегда определяйте маршруты в Screen.kt
  2. Используйте типизированные аргументы
  3. Создавайте вспомогательные методы для генерации маршрутов
  4. Проверяйте все маршруты в навигационном графе

### Проблема с обработкой URI файла
- Что сломалось: FileNotFoundException при попытке открыть файл по URI напрямую
- Как починил:
  1. Создал директорию для документов в локальном хранилище приложения
  2. Реализовал копирование файла из URI в локальное хранилище
  3. Использовал ContentResolver для правильного чтения файла из URI
- В каком файле была ошибка:
  - PdfRepositoryImpl.kt (метод getPdfFromLocal)
- Советы:
  1. Никогда не используйте URI напрямую как путь к файлу
  2. Всегда копируйте файлы из URI в локальное хранилище
  3. Используйте ContentResolver для работы с URI
  4. Генерируйте уникальные имена для сохраняемых файлов
  5. Обрабатывайте ошибки при работе с файловой системой

### Проблема с двойным копированием файлов
- Что сломалось: Файлы копировались дважды при импорте (в getPdfFromLocal и saveDocument)
- Как починил:
  1. Удалил лишний вызов getPdfFromLocal в DocumentListViewModel
  2. Перенес логику копирования файла в метод saveDocument
  3. Передаю URI напрямую в saveDocument
- В каких файлах была ошибка:
  - DocumentListViewModel.kt
  - PdfRepositoryImpl.kt
- Советы:
  1. Избегайте дублирования операций с файлами
  2. Четко определяйте ответственность каждого метода
  3. Используйте URI как промежуточное представление пути к файлу
  4. Выполняйте копирование файла только один раз 

### Проблема с доступом к файлам через ContentProvider
- Что сломалось: Отсутствие FileProvider для безопасного доступа к файлам
- Как починил:
  1. Добавил FileProvider в AndroidManifest.xml
  2. Создал конфигурацию путей в file_paths.xml
  3. Добавил метод getFileProviderUri в PdfRepositoryImpl
  4. Обновил логику работы с файлами для использования FileProvider
- В каких файлах была ошибка:
  - AndroidManifest.xml
  - PdfRepositoryImpl.kt
- Советы:
  1. Всегда используйте FileProvider для предоставления доступа к файлам
  2. Определяйте пути в xml конфигурации
  3. Используйте getUriForFile для получения URI файла
  4. Не забывайте про grantUriPermissions 

### Исправление подхода к работе с файлами
- Что сломалось: Неправильный подход к работе с файлами - попытка работать с URI напрямую
- Как починил:
  1. При импорте файл копируется в локальное хранилище
  2. В базе сохраняется относительный путь к локальной копии
  3. При получении документа путь конвертируется в абсолютный
- В каких файлах была ошибка:
  - PdfRepositoryImpl.kt (метод saveDocument)
- Советы:
  1. Всегда копируйте файлы в локальное хранилище при импорте
  2. Храните относительные пути в базе данных
  3. Используйте методы конвертации путей
  4. Проверяйте существование директорий
  5. Генерируйте уникальные имена файлов
  6. Обрабатывайте ошибки при работе с файлами
  7. Не используйте URI напрямую для доступа к файлам
  8. Работайте через ContentResolver для доступа к содержимому
  9. Сохраняйте URI в базе данных
  10. Избегайте дублирования операций с файлами
  11. Четко определяйте ответственность каждого метода 